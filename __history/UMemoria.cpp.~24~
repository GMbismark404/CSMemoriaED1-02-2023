//---------------------------------------------------------------------------
#pragma hdrstop
#include "UMemoria.h"

//---------------------------------------------------------------------------
#pragma package(smart_init)

CSMemoria::CSMemoria(){
	mem = new NodoM[max];
	for (int i = 0; i < max; i++) {
		mem[i].link = i + 1;
	}
	mem[max - 1].link = -1;
	libre = 0;
}

int CSMemoria::new_espacio(string cad){
	int cant = numero_ids(cad);
	int dir = libre;
	int d = libre;
	for (int i = 0; i < cant - 1; i++) {
		mem[d].id = obtener_id(cad,i);
		d = mem[d].link;
	}

	libre = mem[d].link;
	mem[d].link = -1;
    mem[d].id = obtener_id(cad, cant);
}

int CSMemoria::numero_ids(string id){
int c = 0;
	for (int i = 0; i < id.length(); i++) {
		if ((id[i] != ',') && (id[i+1] == ',')) {
			c++;
		}
	}

	if (id[id.length()] != ',') {
		c++;
	}
}

string CSMemoria::obtener_id(string cad, int i){
int j = 1; int c = 1;
string s = "";
	if (i == 1){
		while (cad[j] != ','){
			s = s + cad[j];
			j++;
		}
	}else{
		while (i == c){
			if ((cad[j] != ',') && (cad[j+1] == ',')) {
				c++; j++;
			}
		j++;
		}

		while (cad[j] != ','){
			s = s + cad[j];
			j++;
		}
	}
return s;
}

void CSMemoria::delete_espacio(int dir){
int x = dir;
	while(mem[x].link != nulo){
		x = mem[x].link;
	}

	mem[x].link = libre;
	libre = dir;
}

int CSMemoria::espacio_disponible(){
int x = libre;
int c = 0;
	while (x != nulo){
		c++;
		x = mem[x].link;
	}
return c;
}

bool CSMemoria::dir_libre(int dir){
bool c = false;
int x = libre;
	while ((x != nulo) && (c == false)){
		if (x == dir) {
			c = true;
		}
		x = mem[x].link;
	}
return c;
}

void CSMemoria::obtener_dato(int dir, string cadena_id){
int z = dir; bool ex = false;

}
